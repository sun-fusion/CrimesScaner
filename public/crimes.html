<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Mapa de Crimes</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body, #map { height: 100%; margin: 0; }
</style>

</head>
<body>
<div id="map"></div>
  <label for="">Offline</label>
  <input type="file" name="Enivar Json" id="JsonsFiles" onclick="Getmap()">
  <label for="">Online</label>
  <form action="/api/crimes" method="post">
    <input type="submit" value="Ver Mapa Comunitario">
  </form>


  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const jsonfilelocal = document.getElementById('JsonFiles');
  
  await function SetJsonMap (){}
  await function Getmap() {
    const map = L.map('map').setView([-22.9, -43.2], 11);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    fetch('/api/crimes')
      .then(r => r.json())
      .then(crimes => {
        crimes.forEach(c => {
          if (c.latitude && c.longitude) {
            L.circle([c.latitude, c.longitude], {
              color: 'red',
              fillColor: '#f03',
              fillOpacity: 0.5,
              radius: 150
            })
            .bindPopup(`
              <b>Tipo:</b> ${c.type}<br>
              <b>Descrição:</b> ${c.description}<br>
              <b>Bairro:</b> ${c.bairro}<br>
              <b>Data:</b> ${new Date(c.data).toLocaleString('pt-BR')}
            `)
            .addTo(map);
          }
        });
      })
      .catch(err => console.error('Erro ao carregar crimes:', err));
  }
  
</script>
</body>
</html>
